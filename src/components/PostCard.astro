---
// src/components/PostCard.astro
import type { Post } from '@/types'

export interface Props {
  post: Post
}

const { post } = Astro.props

const featuredImage = post.metadata.featured_image?.imgix_url
const author = post.metadata.author
const categories = post.metadata.categories || []
const excerpt = post.metadata.excerpt || ''
const publishedDate = post.metadata.published_date

const formattedDate = publishedDate 
  ? new Date(publishedDate).toLocaleDateString('en-US', { 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    })
  : ''
---

<article class="bg-white rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-shadow duration-300">
  {featuredImage && (
    <a href={`/posts/${post.slug}`}>
      <img 
        src={`${featuredImage}?w=800&h=400&fit=crop&auto=format,compress`}
        alt={post.title}
        class="w-full h-48 object-cover"
        width="400"
        height="200"
      />
    </a>
  )}
  <div class="p-6">
    {categories.length > 0 && (
      <div class="flex flex-wrap gap-2 mb-3">
        {categories.map((category) => (
          <a 
            href={`/categories/${category.slug}`}
            class="inline-block px-3 py-1 text-xs font-medium text-primary bg-blue-50 rounded-full hover:bg-blue-100"
          >
            {category.title}
          </a>
        ))}
      </div>
    )}
    <h2 class="text-2xl font-bold text-gray-900 mb-3">
      <a href={`/posts/${post.slug}`} class="hover:text-primary">
        {post.title}
      </a>
    </h2>
    {excerpt && (
      <p class="text-gray-600 mb-4 line-clamp-3">
        {excerpt}
      </p>
    )}
    <div class="flex items-center justify-between text-sm text-gray-500">
      {author && (
        <a href={`/authors/${author.slug}`} class="flex items-center space-x-2 hover:text-primary">
          {author.metadata.avatar?.imgix_url && (
            <img 
              src={`${author.metadata.avatar.imgix_url}?w=80&h=80&fit=crop&auto=format,compress`}
              alt={author.title}
              class="w-8 h-8 rounded-full"
              width="32"
              height="32"
            />
          )}
          <span>{author.title}</span>
        </a>
      )}
      {formattedDate && (
        <time datetime={publishedDate}>{formattedDate}</time>
      )}
    </div>
  </div>
</article>